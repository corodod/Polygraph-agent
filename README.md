# Polygraph Agent

Агент-полиграф для проверки истинности утверждений.

Проект автоматически определяет, можно ли проверить утверждение:
- вычислением (математика, формулы, тригонометрия),
- или нужен поиск в интернете (научные, исторические, бытовые факты),

и возвращает вердикт True / False.

Поддерживает:
- CLI-прогон по датасету
- Web-интерфейс на FastAPI
- OpenRouter (LLM) + Tavily (web search)
- безопасный математический интерпретатор


====================
АРХИТЕКТУРА
====================

Используется langgraph (StateGraph):

1. Router
   - определяет тип задачи: calc или web

2. Math parser (calc)
   - безопасное вычисление выражений
   - поддержка + - * / sin cos
   - тригонометрия в градусах

3. Query rewriter (web)
   - преобразует утверждение в поисковый запрос

4. Web search
   - поиск через Tavily API

5. Judge
   - calc: решение по вычислению
   - web: решение по evidence


====================
ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ
====================

OPENROUTER_API_KEY=...
TAVILY_API_KEY=...

OR_MODEL=mistralai/mistral-7b-instruct


====================
УСТАНОВКА
====================

python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt


====================
ЗАПУСК
====================

Прогон по датасету:
python -m src.main

Web-интерфейс:
python -m uvicorn src.webapp:app --reload --port 8001

http://127.0.0.1:8001


====================
МАТЕМАТИКА
====================

Примеры:
2 + 2 = 4
2500 * 5 - 5 = 0
sin(90) - cos(90) = 1


====================
ПРИНЦИПЫ
====================

- LLM не является источником истины
- вычисления всегда проверяются кодом
- web-факты проверяются только по evidence
- все JSON-ответы нормализуются


====================
ИТОГ
====================

Polygraph Agent — инструментально-ориентированный агент,
где LLM управляет логикой, но не подменяет факты и вычисления.


